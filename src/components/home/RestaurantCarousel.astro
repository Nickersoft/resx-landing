---
import { getCollection } from "astro:content";
import { chunk, last } from "es-toolkit";
import { Carousel } from "@/components/ui/Carousel";
import { Stack } from "@/components/ui/Stack";
import RestaurantCard from "./RestaurantCard.astro";

const count = 5;
const restaurants = await getCollection("restaurants");
const columns = chunk(restaurants, Math.ceil(restaurants.length / count));
const duration = (last(columns)?.length ?? 1) * 23;
---

<Stack
  orientation="row"
  gap="md"
  className="max-lg:flex-col max-lg:mask-r-from-70% max-lg:mask-r-to-transparent max-lg:mask-l-from-70% max-lg:mask-l-to-transparent lg:mt-28 lg:mask-t-from-70% lg:mask-t-to-transparent lg:mask-b-from-70% lg:mask-b-to-transparent"
>
  {
    columns.map((cells, i) => (
      <Carousel
        duration={duration}
        gap={4}
        direction={i % 2 ? "up" : "down"}
        client:load
      >
        {cells.map((restaurant) => (
          <RestaurantCard restaurant={restaurant} />
        ))}
      </Carousel>
    ))
  }
</Stack>
