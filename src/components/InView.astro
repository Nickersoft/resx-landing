---
interface Props {
  amount?: number;
  once?: boolean;
}

const { amount = 0.3, once = false } = Astro.props;
---

<in-view data-amount={amount} data-once={once}>
  <slot />
</in-view>

<script>
  import { inView } from "motion";

  class InView extends HTMLElement {
    constructor() {
      super();
    }

    connectedCallback() {
      inView(
        this,
        () => {
          this.setAttribute("data-in-view", "");
          return () => {
            const once = this.dataset.once === "true";
            if (once) return;
            this.removeAttribute("data-in-view");
          };
        },
        {
          ...(this.dataset.amount && {
            amount: parseFloat(this.dataset.amount),
          }),
        },
      );
    }
  }

  customElements.define("in-view", InView);
</script>
