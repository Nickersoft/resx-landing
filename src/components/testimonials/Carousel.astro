---
import type { CollectionEntry } from "astro:content";
import { chunk } from "es-toolkit";

import { Carousel as BaseCarousel } from "@/components/ui/Carousel";
import { Stack } from "@/components/ui/Stack";

import TestimonialCard from "./Testimonial.astro";

export interface Props {
  testimonials: CollectionEntry<"testimonials">[];
}

const { testimonials } = Astro.props;

const rows = chunk(testimonials, Math.ceil(testimonials.length / 2));
---

<Stack orientation="column" align="center" gap="lg">
  {
    rows.map((row, i) => (
      <BaseCarousel
        style={{ animationDelay: `${(i + 1) * 0.15}s` }}
        data-idx={i}
        className="lg:animate-in lg:slide-in-from-bottom-12 lg:paused lg:in-view:running lg:fill-mode-both lg:fade-in-0 mask-x-from-80% mask-x-to-transparent lg:duration-1000"
        duration={rows[0].length * 20}
        direction={i % 2 === 0 ? "left" : "right"}
      >
        {row.map((testimonial) => (
          <TestimonialCard testimonial={testimonial} />
        ))}
      </BaseCarousel>
    ))
  }
</Stack>
